---
import { siteConfig } from '@/config/site';
import BookingForm from '@/components/ui/BookingForm.astro';
import Card from '@/components/ui/Card.astro';
---

<section class="relative py-4 sm:py-6 lg:py-8 min-h-screen flex items-center overflow-hidden hero-section">
  <!-- Optimized Video Background -->
  <video
    autoplay
    muted
    loop
    playsinline
    preload="metadata"
    class="absolute inset-0 w-full h-full object-cover hero-video"
    id="heroVideo"
    poster="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1920 1080'%3E%3Cdefs%3E%3ClinearGradient id='bg' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' stop-color='%231D1912'/%3E%3Cstop offset='100%25' stop-color='%232A2420'/%3E%3C/linearGradient%3E%3C/defs%3E%3Crect width='100%25' height='100%25' fill='url(%23bg)'/%3E%3C/svg%3E"
    crossorigin="anonymous"
    disablePictureInPicture
    x-webkit-airplay="deny"
  >
    <source src="https://qjvikxuhqs1py0go.public.blob.vercel-storage.com/ez2fix-hero-background.mp4" type="video/mp4">
    Your browser does not support the video tag.
  </video>

  <!-- Gray Tint Overlay -->
  <div class="absolute inset-0 bg-black bg-opacity-60"></div>

  <div class="container mx-auto px-4 relative z-10 w-full">
    <div class="max-w-7xl mx-auto">
      
      <!-- Hero Content Grid -->
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 lg:gap-8 items-center">
        
        <!-- Left Side - Hero Content -->
        <div class="text-center lg:text-left order-2 lg:order-1">
          
          <!-- Trust Indicators -->
          <div class="flex justify-center lg:justify-start items-center space-x-4 mb-4">
            <div class="flex items-center space-x-1">
              <svg class="h-4 w-4" style="color: #D2A63C;" fill="currentColor" viewBox="0 0 24 24">
                <path d="M12 .587l3.668 7.431 8.332 1.151-6.064 5.828 1.48 8.279-7.416-3.967-7.417 3.967 1.481-8.279-6.064-5.828 8.332-1.151z"/>
              </svg>
              <span class="text-xs font-semibold" style="color: #EECD5C;">Neighbors Love Us</span>
            </div>
            <div class="flex items-center space-x-1">
              <svg class="h-4 w-4" style="color: #BB8525;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4"/>
              </svg>
              <span class="text-xs font-semibold" style="color: #EECD5C;">Licensed & Insured</span>
            </div>
          </div>

          <!-- Main Headlines -->
          <h1 class="text-2xl xs:text-3xl sm:text-4xl lg:text-5xl xl:text-6xl font-bold leading-tight mb-3 sm:mb-4 hero-animate">
            <span style="color: #F3F3E6;">When Your Garage Door Breaks</span>
            <br />
            <span style="color: #EECD5C;">Your Neighbors Call</span> <span style="color: #D2A63C;">Ez2Fix</span>
          </h1>
          
          <!-- Subtitle -->
          <p class="text-base sm:text-lg md:text-xl leading-relaxed mb-4 sm:mb-5 max-w-2xl mx-auto lg:mx-0 hero-animate" style="color: #F3F3E6;">
            That panic when you're late for work and your door won't budge. The stress when it won't close and your home isn't secure. We've been there. 
            For over 15 years, <span style="color: #EECD5C; font-weight: 600;">10,000+ Northern NJ families</span> have trusted us to restore their peace of mind.
          </p>
          
          <!-- CTAs -->
          <div class="flex flex-col sm:flex-row gap-3 sm:gap-4 mb-4 sm:mb-5 lg:mb-0 hero-animate">
            <a 
              href={siteConfig.links.phone}
              class="inline-flex items-center justify-center px-4 sm:px-6 py-3 text-base sm:text-lg font-bold rounded-lg transition-all duration-300 hover:shadow-xl transform hover:scale-105"
              style="background: linear-gradient(135deg, #BB8525 0%, #D2A63C 100%); color: #F3F3E6;"
            >
              <svg class="mr-2 h-4 w-4 sm:h-5 sm:w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"/>
              </svg>
              Call {siteConfig.business.phone}
            </a>
            <a 
              href="/services"
              class="inline-flex items-center justify-center px-4 sm:px-6 py-3 text-base sm:text-lg font-semibold border-2 rounded-lg transition-all duration-300 hover:shadow-xl hover:bg-white"
              style="color: #EECD5C; border-color: #EECD5C; background-color: rgba(238, 205, 92, 0.1);"
            >
              View All Services
            </a>
          </div>
        </div>

        <!-- Right Side - Booking Form (Desktop) -->
        <div class="order-1 lg:order-2 hidden lg:block hero-animate">
          <Card class="p-3 lg:p-5 shadow-2xl border-2" style="background-color: #F3F3E6; border-color: #D2A63C;">
            <BookingForm 
              variant="hero"
              title="Get Your Free Estimate"
              subtitle="Tell us about your garage door issue and we'll provide an honest, detailed estimate."
              buttonText="Get My Free Estimate"
            />
            
            <!-- Form Benefits -->
            <div class="mt-2 pt-2 border-t" style="border-color: rgba(187, 133, 37, 0.2);">
              <div class="grid grid-cols-2 gap-2 text-center">
                <div>
                  <div class="text-xs font-semibold" style="color: #1D1912;">Service</div>
                  <div class="text-xs" style="color: #BB8525;">Professional</div>
                </div>
                <div>
                  <div class="text-xs font-semibold" style="color: #1D1912;">Free Estimates</div>
                  <div class="text-xs" style="color: #BB8525;">No Hidden Fees</div>
                </div>
              </div>
            </div>
          </Card>
        </div>
      </div>

      <!-- Bottom Trust Bar -->
      <div class="mt-3 lg:mt-4 pt-2 border-t border-opacity-20" style="border-color: #EECD5C;">
        <div class="flex flex-col lg:flex-row justify-center lg:justify-between items-center gap-3 lg:gap-6">
          
          <!-- Service Areas -->
          <div class="text-center lg:text-left">
            <div class="text-xs font-semibold mb-1" style="color: #EECD5C;">Your Northern NJ Neighbors Trust Us:</div>
            <div class="text-xs" style="color: #F3F3E6;">
              Jersey City • Hoboken • Elmwood Park • Fair Lawn • Garfield + More
            </div>
          </div>
          
          <!-- Credentials -->
          <div class="flex items-center space-x-3 lg:space-x-4">
            <div class="text-center">
              <div class="text-xs font-semibold" style="color: #D2A63C;">You Can Trust Us</div>
              <div class="text-xs opacity-75" style="color: #F3F3E6;">{siteConfig.business.license}</div>
            </div>
            <div class="text-center">
              <div class="text-xs font-semibold" style="color: #EECD5C;">We Live Here Too</div>
              <div class="text-xs opacity-75" style="color: #F3F3E6;">Since 2014</div>
            </div>
            <div class="text-center">
              <div class="text-xs font-semibold" style="color: #BB8525;">We Stand Behind</div>
              <div class="text-xs opacity-75" style="color: #F3F3E6;">Our Work</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<style>
  .hero-section {
    /* Ensure proper viewport height on mobile */
    min-height: 100vh;
    min-height: 100dvh; /* Dynamic viewport height for modern browsers */
  }

  /* Animation classes for hero elements */
  .hero-animate {
    opacity: 0;
    transform: translateY(30px);
    transition: all 0.8s cubic-bezier(0.4, 0, 0.2, 1);
  }

  .hero-animate.animate-in {
    opacity: 1;
    transform: translateY(0);
  }

  /* Staggered animation delays for hero elements */
  .hero-animate:nth-child(1) { transition-delay: 0.1s; }
  .hero-animate:nth-child(2) { transition-delay: 0.2s; }
  .hero-animate:nth-child(3) { transition-delay: 0.3s; }
  .hero-animate:nth-child(4) { transition-delay: 0.4s; }
  .hero-animate:nth-child(5) { transition-delay: 0.5s; }

  /* Hover animations for interactive elements */
  .hero-section a {
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  }

  .hero-section a:hover {
    transform: translateY(-2px);
  }


  /* Mobile landscape adjustments */
  @media screen and (max-height: 600px) and (orientation: landscape) {
    .hero-section {
      min-height: auto;
      padding-top: 2rem;
      padding-bottom: 2rem;
    }
  }

  /* Small mobile devices */
  @media screen and (max-width: 480px) {
    .hero-section {
      padding-top: 0.5rem;
      padding-bottom: 0.5rem;
    }
  }
  
  /* Extra small devices */
  @media screen and (max-width: 360px) {
    .hero-section {
      padding-top: 0.25rem;
      padding-bottom: 0.25rem;
    }
    
    .hero-section .container {
      padding-left: 0.75rem;
      padding-right: 0.75rem;
    }
  }

  /* Ensure touch targets are accessible */
  @media (hover: none) and (pointer: coarse) {
    .hero-section button,
    .hero-section a {
      min-height: 44px;
      min-width: 44px;
    }
  }

  /* Optimize video loading performance */
  @media (prefers-reduced-motion: reduce) {
    .hero-video {
      display: none;
    }
    .hero-section {
      background: linear-gradient(135deg, #1D1912 0%, #2A2420 100%);
    }
  }

  /* Custom xs breakpoint */
  @media (min-width: 475px) {
    .xs\:text-3xl {
      font-size: 1.875rem;
      line-height: 2.25rem;
    }
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Optimized video loading for performance
    const heroVideo = document.getElementById('heroVideo');
    if (heroVideo) {
      // Check if user prefers reduced motion
      const prefersReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
      
      // Check connection type for data-conscious loading
      const connection = navigator.connection || navigator.mozConnection || navigator.webkitConnection;
      const isSlowConnection = connection && (connection.effectiveType === 'slow-2g' || connection.effectiveType === '2g');
      
      if (prefersReducedMotion || isSlowConnection) {
        heroVideo.style.display = 'none';
        heroVideo.closest('.hero-section').style.background = 'linear-gradient(135deg, #1D1912 0%, #2A2420 100%)';
      } else {
        // Optimized video loading
        heroVideo.addEventListener('loadedmetadata', function() {
          this.currentTime = 0;
        });
        
        heroVideo.addEventListener('canplaythrough', function() {
          this.style.opacity = '1';
        });
        
        // Ensure video plays
        const playPromise = heroVideo.play();
        if (playPromise !== undefined) {
          playPromise.catch(error => {
            console.log('Video autoplay prevented:', error);
            heroVideo.style.display = 'none';
            heroVideo.closest('.hero-section').style.background = 'linear-gradient(135deg, #1D1912 0%, #2A2420 100%)';
          });
        }
      }
    }

    // Enhanced animations for other elements
    const animateOnScroll = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          entry.target.classList.add('animate-in');
          animateOnScroll.unobserve(entry.target); // Performance optimization
        }
      });
    }, { 
      threshold: 0.1,
      rootMargin: '0px 0px -50px 0px' // Trigger slightly before element is visible
    });

    // Animate hero content elements with optimized timing
    const elementsToAnimate = document.querySelectorAll('.hero-animate');
    
    // Use requestAnimationFrame for smooth animations
    requestAnimationFrame(() => {
      elementsToAnimate.forEach((el, index) => {
        setTimeout(() => {
          el.classList.add('animate-in');
        }, index * 100); // Faster, smoother staggered animation
      });
    });
    
    // Observe for scroll animations
    document.querySelectorAll('.animate-on-scroll').forEach(el => {
      animateOnScroll.observe(el);
    });
    
    // Optimize form interactions for mobile
    if ('ontouchstart' in window) {
      document.addEventListener('touchstart', function() {}, {passive: true});
    }
  });
</script>